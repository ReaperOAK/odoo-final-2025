import{r as l,u as G,j as e,V as g,d as re,e as ne,L as $,k as ie,h as V,U as oe,H as le,b as ce,l as de}from"./index-76169fad.js";import{l as Q}from"./listings-af106268.js";import{o as me}from"./orders-5706a65b.js";import{A as L,D as ge}from"./DateRangePicker-b09cb43c.js";import{p as E}from"./payments-eb4ce9d6.js";import{P as q}from"./PhotoIcon-c505ca73.js";import{M as ue}from"./MapPinIcon-dea18e68.js";import{H as xe,a as he}from"./HeartIcon-9271f9a0.js";import{r as I,t as N,a as fe,g as Y}from"./index-e31d7439.js";function ye({title:a,titleId:t,...n},s){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),a?l.createElement("title",{id:t},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 3v1.5M3 21v-6m0 0 2.77-.693a9 9 0 0 1 6.208.682l.108.054a9 9 0 0 0 6.086.71l3.114-.732a48.524 48.524 0 0 1-.005-10.499l-3.11.732a9 9 0 0 1-6.085-.711l-.108-.054a9 9 0 0 0-6.208-.682L3 4.5M3 15V4.5"}))}const pe=l.forwardRef(ye),be=pe;function ve({title:a,titleId:t,...n},s){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),a?l.createElement("title",{id:t},a):null,l.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7.217 10.907a2.25 2.25 0 1 0 0 2.186m0-2.186c.18.324.283.696.283 1.093s-.103.77-.283 1.093m0-2.186 9.566-5.314m-9.566 7.5 9.566 5.314m0 0a2.25 2.25 0 1 0 3.935 2.186 2.25 2.25 0 0 0-3.935-2.186Zm0-12.814a2.25 2.25 0 1 0 3.933-2.185 2.25 2.25 0 0 0-3.933 2.185Z"}))}const je=l.forwardRef(ve),we=je;function Ne(a,t){I(2,arguments);var n=N(a),s=fe(t);return isNaN(s)?new Date(NaN):(s&&n.setDate(n.getDate()+s),n)}function U(a){I(1,arguments);var t=N(a);return t.setHours(0,0,0,0),t}var Ie=864e5;function ke(a,t){I(2,arguments);var n=U(a),s=U(t),f=n.getTime()-Y(n),b=s.getTime()-Y(s);return Math.round((f-b)/Ie)}var Pe=36e5;function W(a,t){var n=a.getFullYear()-t.getFullYear()||a.getMonth()-t.getMonth()||a.getDate()-t.getDate()||a.getHours()-t.getHours()||a.getMinutes()-t.getMinutes()||a.getSeconds()-t.getSeconds()||a.getMilliseconds()-t.getMilliseconds();return n<0?-1:n>0?1:n}function Z(a,t){I(2,arguments);var n=N(a),s=N(t),f=W(n,s),b=Math.abs(ke(n,s));n.setDate(n.getDate()-f*b);var w=+(W(n,s)===-f),r=f*(b-w);return r===0?0:r}function Se(a,t){return I(2,arguments),N(a).getTime()-N(t).getTime()}var K={ceil:Math.ceil,round:Math.round,floor:Math.floor,trunc:function(t){return t<0?Math.ceil(t):Math.floor(t)}},De="trunc";function Me(a){return a?K[a]:K[De]}function Le(a,t,n){I(2,arguments);var s=Se(a,t)/Pe;return Me(n==null?void 0:n.roundingMethod)(s)}const Re=({orderData:a,onSuccess:t,onFailure:n,onCancel:s,disabled:f=!1,buttonText:b="Pay Now",className:w="",mockMode:r=!1})=>{const{user:o}=G(),[y,P]=l.useState(!1),[S,k]=l.useState(!1);l.useEffect(()=>{r?k(!0):(()=>{if(window.Razorpay){k(!0);return}const c=document.createElement("script");c.src="https://checkout.razorpay.com/v1/checkout.js",c.onload=()=>k(!0),c.onerror=()=>{console.error("Failed to load Razorpay script"),g.error("Payment system unavailable. Please try again.")},document.body.appendChild(c)})()},[r]);const u=async()=>{if(!a){g.error("Order data is required");return}P(!0);try{r?await R():await v()}catch(d){console.error("Payment error:",d),g.error(d.message||"Payment failed. Please try again."),n&&n(d)}finally{P(!1)}},R=async()=>{await new Promise(c=>setTimeout(c,2e3));const d={orderId:a.orderId,paymentId:`mock_pay_${Date.now()}`,razorpayOrderId:`mock_order_${Date.now()}`,amount:a.amount,currency:"INR",status:"success"};try{const c=await E.processMockPayment(d);if(c.success)g.success("Payment successful!"),t&&t({paymentId:d.paymentId,orderId:d.orderId,amount:d.amount,response:c.data});else throw new Error(c.message||"Mock payment failed")}catch{throw new Error("Mock payment processing failed")}},v=async()=>{var d,c;try{const p=await E.createRazorpayOrder({orderId:a.orderId,amount:a.amount,currency:a.currency||"INR",customerInfo:{name:o==null?void 0:o.name,email:o==null?void 0:o.email,contact:(o==null?void 0:o.phone)||((d=o==null?void 0:o.hostProfile)==null?void 0:d.phone)}});if(!p.success)throw new Error(p.message||"Failed to create payment order");const{razorpayOrderId:_,amount:z,currency:A}=p.data,C={key:{}.VITE_RAZORPAY_KEY_ID,amount:z*100,currency:A,name:"P2P Marketplace",description:`Payment for Order #${a.orderId}`,order_id:_,prefill:{name:(o==null?void 0:o.name)||"",email:(o==null?void 0:o.email)||"",contact:(o==null?void 0:o.phone)||((c=o==null?void 0:o.hostProfile)==null?void 0:c.phone)||""},theme:{color:"#6366f1"},modal:{ondismiss:()=>{s&&s()}},handler:async h=>{try{const j=await E.verifyPayment({razorpay_order_id:h.razorpay_order_id,razorpay_payment_id:h.razorpay_payment_id,razorpay_signature:h.razorpay_signature,orderId:a.orderId});if(j.success)g.success("Payment successful!"),t&&t({paymentId:h.razorpay_payment_id,orderId:a.orderId,amount:z,response:j.data});else throw new Error(j.message||"Payment verification failed")}catch(j){console.error("Payment verification error:",j),g.error("Payment verification failed"),n&&n(j)}}},M=new window.Razorpay(C);M.on("payment.failed",h=>{console.error("Payment failed:",h.error),g.error(`Payment failed: ${h.error.description}`),n&&n(h.error)}),M.open()}catch(p){throw p}},D=f||y||!S&&!r;return e.jsx("button",{onClick:u,disabled:D,className:`
        relative px-6 py-3 bg-primary-600 text-white font-semibold rounded-lg
        hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2
        disabled:bg-gray-400 disabled:cursor-not-allowed
        transition-all duration-200 transform hover:scale-105 active:scale-95
        ${w}
      `,children:y?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),r?"Processing...":"Loading..."]}):e.jsxs(e.Fragment,{children:[r&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-yellow-400 text-yellow-900 text-xs px-2 py-1 rounded-full font-medium",children:"DEMO"}),b]})})},He=()=>{var F,B,O,H;const{id:a}=re(),t=ne(),{user:n}=G(),[s,f]=l.useState(null),[b,w]=l.useState(!0),[r,o]=l.useState({start:null,end:null}),[y,P]=l.useState(1),[S,k]=l.useState(!1),[u,R]=l.useState(null),[v,D]=l.useState(null),[d,c]=l.useState(0),[p,_]=l.useState(!1),[z,A]=l.useState(!1);l.useEffect(()=>{C()},[a]),l.useEffect(()=>{r.start&&r.end&&s&&(M(),h())},[r,y,s]);const C=async()=>{try{w(!0);const i=await Q.getListing(a);if(i.success)f(i.data);else throw new Error(i.message||"Listing not found")}catch(i){console.error("Error loading listing:",i),g.error("Failed to load listing"),t("/listings")}finally{w(!1)}},M=async()=>{if(!(!r.start||!r.end||!s))try{const i={listingId:s._id,startDate:r.start,endDate:r.end,quantity:y},m=await me.calculatePricing(i);m.success&&R(m.data)}catch(i){console.error("Error calculating pricing:",i)}},h=async()=>{if(!(!r.start||!r.end||!s))try{const i=await Q.checkAvailability(s._id,{start:r.start.toISOString(),end:r.end.toISOString(),qty:y});D(i.data)}catch(i){console.error("Error checking availability:",i),D({available:!1,message:"Unable to check availability"})}},j=i=>{g.success("Booking confirmed successfully!"),t("/my-bookings")},J=i=>{g.error("Payment failed. Please try again."),k(!1)},X=()=>{_(!p),g.success(p?"Removed from favorites":"Added to favorites")},ee=()=>{navigator.share?navigator.share({title:s.title,text:s.description,url:window.location.href}):(navigator.clipboard.writeText(window.location.href),g.success("Link copied to clipboard"))},T=()=>!r.start||!r.end?0:s.unitType==="hour"?Le(r.end,r.start):s.unitType==="week"?Math.ceil(Z(r.end,r.start)/7):Z(r.end,r.start),se=()=>{s.images.length>0&&c(i=>(i+1)%s.images.length)},ae=()=>{s.images.length>0&&c(i=>i===0?s.images.length-1:i-1)};if(b)return e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsx("div",{className:"h-96 bg-gray-200 rounded-lg"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})]})]})});if(!s)return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-16 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Listing not found"}),e.jsx("p",{className:"text-gray-600 mb-8",children:"The listing you're looking for doesn't exist or has been removed."}),e.jsxs($,{to:"/listings",className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-200",children:[e.jsx(L,{className:"w-5 h-5 mr-2"}),"Back to Listings"]})]});const x=s.ownerId||{},te=s.images&&s.images.length>0;return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("button",{onClick:()=>t(-1),className:"inline-flex items-center text-gray-600 hover:text-gray-900 mb-6 transition-colors duration-200",children:[e.jsx(L,{className:"w-5 h-5 mr-2"}),"Back"]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[te?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative aspect-video bg-gray-100 rounded-lg overflow-hidden",children:[e.jsx("img",{src:s.images[d],alt:s.title,className:"w-full h-full object-cover"}),s.images.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ae,className:"absolute left-4 top-1/2 transform -translate-y-1/2 bg-white/80 backdrop-blur-sm p-2 rounded-full hover:bg-white transition-colors duration-200",children:e.jsx(L,{className:"w-5 h-5"})}),e.jsx("button",{onClick:se,className:"absolute right-4 top-1/2 transform -translate-y-1/2 bg-white/80 backdrop-blur-sm p-2 rounded-full hover:bg-white transition-colors duration-200",children:e.jsx(L,{className:"w-5 h-5 transform rotate-180"})})]}),e.jsxs("div",{className:"absolute bottom-4 right-4 bg-black/50 text-white px-3 py-1 rounded-full text-sm",children:[d+1," / ",s.images.length]}),s.images.length>1&&e.jsxs("button",{onClick:()=>A(!0),className:"absolute bottom-4 left-4 bg-white text-gray-900 px-3 py-1 rounded-full text-sm hover:bg-gray-100 transition-colors duration-200",children:[e.jsx(q,{className:"w-4 h-4 inline mr-1"}),"View all ",s.images.length," photos"]})]}),s.images.length>1&&e.jsx("div",{className:"grid grid-cols-5 gap-2",children:s.images.slice(0,5).map((i,m)=>e.jsx("button",{onClick:()=>c(m),className:ie("aspect-square rounded-lg overflow-hidden border-2 transition-all duration-200",d===m?"border-primary-500 ring-2 ring-primary-200":"border-gray-200 hover:border-gray-300"),children:e.jsx("img",{src:i,alt:`${s.title} ${m+1}`,className:"w-full h-full object-cover"})},m))})]}):e.jsx("div",{className:"aspect-video bg-gray-100 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center text-gray-400",children:[e.jsx(q,{className:"w-16 h-16 mx-auto mb-2"}),e.jsx("p",{children:"No images available"})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(ue,{className:"w-4 h-4 mr-1"}),s.location]}),s.averageRating&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"w-4 h-4 mr-1 text-yellow-400 fill-current"}),s.averageRating.toFixed(1),s.totalReviews&&` (${s.totalReviews} reviews)`]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:X,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:p?e.jsx(xe,{className:"w-5 h-5 text-red-500"}):e.jsx(he,{className:"w-5 h-5 text-gray-600"})}),e.jsx("button",{onClick:ee,className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors duration-200",children:e.jsx(we,{className:"w-5 h-5 text-gray-600"})})]})]}),e.jsxs("div",{className:"flex items-center space-x-3 mb-6 p-4 bg-gray-50 rounded-lg",children:[x.profileImage?e.jsx("img",{src:x.profileImage,alt:x.name||x.displayName,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded-full flex items-center justify-center",children:e.jsx(oe,{className:"w-6 h-6 text-gray-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("h3",{className:"font-medium text-gray-900",children:["Hosted by ",x.name||x.displayName||"Host"]}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx(le,{host:x,size:"small"}),x.averageRating&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(V,{className:"w-3 h-3 mr-1 text-yellow-400 fill-current"}),x.averageRating.toFixed(1)]})]})]}),e.jsx($,{to:`/hosts/${x._id}`,className:"text-primary-600 hover:text-primary-700 text-sm font-medium",children:"View Profile"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Description"}),e.jsx("p",{className:"text-gray-700 whitespace-pre-wrap",children:s.description})]}),s.features&&s.features.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Features"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-3",children:s.features.map((i,m)=>e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-700",children:[e.jsx("div",{className:"w-2 h-2 bg-primary-600 rounded-full"}),e.jsx("span",{children:i})]},m))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Booking Policies"}),e.jsxs("div",{className:"space-y-2 text-sm text-gray-700",children:[((F=s.policies)==null?void 0:F.cancellationPolicy)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:["Cancellation: ",s.policies.cancellationPolicy]})]}),((B=s.policies)==null?void 0:B.minimumBookingPeriod)&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{children:["Minimum booking: ",s.policies.minimumBookingPeriod," ",s.unitType,s.policies.minimumBookingPeriod>1?"s":""]})]})]})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsxs("div",{className:"sticky top-8 bg-white rounded-lg shadow-lg border p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-baseline space-x-2",children:[e.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["₹",s.basePrice.toLocaleString()]}),e.jsxs("span",{className:"text-gray-600",children:["/ ",s.unitType]})]}),s.totalQuantity&&e.jsxs("p",{className:"text-sm text-gray-600 mt-1",children:[s.totalQuantity," available"]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Select Dates"}),e.jsx(ge,{startDate:r.start,endDate:r.end,onDatesChange:o,minDate:Ne(new Date,1),unitType:s.unitType})]}),s.totalQuantity>1&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity"}),e.jsx("select",{value:y,onChange:i=>P(parseInt(i.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[...Array(Math.min(s.totalQuantity,10))].map((i,m)=>e.jsx("option",{value:m+1,children:m+1},m+1))})]}),r.start&&r.end&&e.jsx("div",{className:"mb-6",children:v===null?e.jsxs("div",{className:"flex items-center space-x-2 text-gray-600",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"}),e.jsx("span",{className:"text-sm",children:"Checking availability..."})]}):v.available?e.jsxs("div",{className:"flex items-center space-x-2 text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:"Available for selected dates"})]}):e.jsxs("div",{className:"flex items-center space-x-2 text-red-600",children:[e.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsx("span",{className:"text-sm font-medium",children:v.message||"Not available"})]})}),u&&r.start&&r.end&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Price Breakdown"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["₹",s.basePrice," × ",T()," ",s.unitType,T()>1?"s":"",y>1&&` × ${y}`]}),e.jsxs("span",{children:["₹",(O=u.subtotal)==null?void 0:O.toLocaleString()]})]}),u.platformFee&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Platform fee"}),e.jsxs("span",{children:["₹",u.platformFee.toLocaleString()]})]}),u.depositAmount&&e.jsxs("div",{className:"flex justify-between text-orange-600",children:[e.jsx("span",{children:"Security deposit"}),e.jsxs("span",{children:["₹",u.depositAmount.toLocaleString()]})]}),e.jsxs("div",{className:"border-t border-gray-200 pt-2 flex justify-between font-medium",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",(H=u.totalAmount)==null?void 0:H.toLocaleString()]})]})]})]}),(n==null?void 0:n.id)===x._id?e.jsx("button",{disabled:!0,className:"w-full py-3 bg-gray-100 text-gray-500 rounded-lg font-medium cursor-not-allowed",children:"This is your listing"}):e.jsx(Re,{orderData:u?{orderId:null,amount:u.totalAmount,currency:"INR"}:null,onSuccess:j,onFailure:J,disabled:!r.start||!r.end||!(v!=null&&v.available)||S,buttonText:S?"Booking...":"Book Now",className:"w-full",mockMode:!0}),e.jsx("button",{className:"w-full mt-3 py-3 border border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors duration-200",children:"Contact Host"}),e.jsxs("button",{className:"w-full mt-2 py-2 text-gray-500 text-sm hover:text-gray-700 transition-colors duration-200 flex items-center justify-center",children:[e.jsx(be,{className:"w-4 h-4 mr-1"}),"Report this listing"]})]})})]})]})};export{He as default};
