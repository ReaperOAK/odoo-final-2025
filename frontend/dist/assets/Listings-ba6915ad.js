import{r as c,i as H,V as A,j as e,k as _,X as q,L as z}from"./index-76169fad.js";import{l as G}from"./listings-af106268.js";import{L as D}from"./ListingCard-61dd8ca7.js";import{M as B}from"./MagnifyingGlassIcon-c9e2ef4c.js";import{M as U}from"./MapPinIcon-dea18e68.js";import{A as $}from"./AdjustmentsHorizontalIcon-a4d8d255.js";import{F as W}from"./FunnelIcon-3d36d466.js";import"./HeartIcon-9271f9a0.js";import"./index-11ece73b.js";import"./index-e31d7439.js";var k=new Map,R=new WeakMap,I=0,X=void 0;function Y(s){return s?(R.has(s)||(I+=1,R.set(s,I.toString())),R.get(s)):"0"}function J(s){return Object.keys(s).sort().filter(t=>s[t]!==void 0).map(t=>`${t}_${t==="root"?Y(s.root):s[t]}`).toString()}function K(s){const t=J(s);let a=k.get(t);if(!a){const m=new Map;let d;const u=new IntersectionObserver(l=>{l.forEach(i=>{var g;const h=i.isIntersecting&&d.some(f=>i.intersectionRatio>=f);s.trackVisibility&&typeof i.isVisible>"u"&&(i.isVisible=h),(g=m.get(i.target))==null||g.forEach(f=>{f(h,i)})})},s);d=u.thresholds||(Array.isArray(s.threshold)?s.threshold:[s.threshold||0]),a={id:t,observer:u,elements:m},k.set(t,a)}return a}function Q(s,t,a={},m=X){if(typeof window.IntersectionObserver>"u"&&m!==void 0){const g=s.getBoundingClientRect();return t(m,{isIntersecting:m,target:s,intersectionRatio:typeof a.threshold=="number"?a.threshold:0,time:0,boundingClientRect:g,intersectionRect:g,rootBounds:g}),()=>{}}const{id:d,observer:u,elements:l}=K(a),i=l.get(s)||[];return l.has(s)||l.set(s,i),i.push(t),u.observe(s),function(){i.splice(i.indexOf(t),1),i.length===0&&(l.delete(s),u.unobserve(s)),l.size===0&&(u.disconnect(),k.delete(d))}}function Z({threshold:s,delay:t,trackVisibility:a,rootMargin:m,root:d,triggerOnce:u,skip:l,initialInView:i,fallbackInView:g,onChange:h}={}){var f;const[b,E]=c.useState(null),P=c.useRef(h),[n,F]=c.useState({inView:!!i,entry:void 0});P.current=h,c.useEffect(()=>{if(l||!b)return;let v;return v=Q(b,(j,x)=>{F({inView:j,entry:x}),P.current&&P.current(j,x),x.isIntersecting&&u&&v&&(v(),v=void 0)},{root:d,rootMargin:m,threshold:s,trackVisibility:a,delay:t},g),()=>{v&&v()}},[Array.isArray(s)?s.toString():s,b,d,m,u,l,a,g,t]);const S=(f=n.entry)==null?void 0:f.target,C=c.useRef(void 0);!b&&S&&!u&&!l&&C.current!==S&&(C.current=S,F({inView:!!i,entry:void 0}));const p=[E,n.inView,n.entry];return p.ref=p[0],p.inView=p[1],p.entry=p[2],p}const ue=()=>{const[s,t]=H(),[a,m]=c.useState([]),[d,u]=c.useState(!0),[l,i]=c.useState(!0),[g,h]=c.useState(1),[f,b]=c.useState(!1),[E,P]=c.useState(new Set),[n,F]=c.useState({query:s.get("q")||"",category:s.get("category")||"",location:s.get("location")||"",minPrice:s.get("minPrice")||"",maxPrice:s.get("maxPrice")||"",unitType:s.get("unitType")||"",sortBy:s.get("sortBy")||"recent",verifiedOnly:s.get("verifiedOnly")==="true"}),{ref:S,inView:C}=Z({threshold:0,rootMargin:"100px"}),p=["Electronics & Gadgets","Camera & Photography","Audio & Music","Sports & Fitness","Outdoor & Adventure","Transportation","Tools & Equipment","Party & Events","Gaming","Home & Garden","Fashion & Accessories","Books & Media","Other"],v=[{value:"recent",label:"Most Recent"},{value:"price_low",label:"Price: Low to High"},{value:"price_high",label:"Price: High to Low"},{value:"rating",label:"Highest Rated"},{value:"popular",label:"Most Popular"}];c.useEffect(()=>{j(!0)},[n]),c.useEffect(()=>{C&&l&&!d&&j(!1)},[C,l,d]);const j=async(r=!1)=>{try{u(!0);const o={...n,page:r?1:g,limit:12};Object.keys(o).forEach(y=>{(o[y]===""||o[y]===null||o[y]===void 0)&&delete o[y]});const w=await G.getListings(o);if(w.success){const{listings:y,hasMore:L,totalCount:ee}=w.data;r?(m(y),h(2)):(m(O=>[...O,...y]),h(O=>O+1)),i(L)}else throw new Error(w.message||"Failed to load listings")}catch(N){console.error("Error loading listings:",N),A.error("Failed to load listings")}finally{u(!1)}},x=(r,N)=>{const o={...n,[r]:N};F(o);const w=new URLSearchParams;Object.entries(o).forEach(([y,L])=>{L&&w.set(y,L)}),t(w),h(1)},T=()=>{F({query:"",category:"",location:"",minPrice:"",maxPrice:"",unitType:"",sortBy:"recent",verifiedOnly:!1}),t({}),h(1)},V=r=>{P(N=>{const o=new Set(N);return o.has(r)?(o.delete(r),A.success("Removed from favorites")):(o.add(r),A.success("Added to favorites")),o})},M=Object.values(n).some(r=>r!==""&&r!=="recent"&&r!==!1);return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Browse Listings"}),e.jsx("p",{className:"text-gray-600",children:"Discover amazing items from verified hosts in your area"})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border p-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center space-y-4 lg:space-y-0 lg:space-x-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(B,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search for items...",value:n.query,onChange:r=>x("query",r.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsx("div",{className:"lg:w-48",children:e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute left-3 top-3 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Location",value:n.location,onChange:r=>x("location",r.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})}),e.jsx("div",{className:"lg:w-48",children:e.jsx("select",{value:n.sortBy,onChange:r=>x("sortBy",r.target.value),className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:v.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))})}),e.jsxs("button",{onClick:()=>b(!f),className:_("inline-flex items-center px-4 py-3 border border-gray-300 rounded-lg transition-colors duration-200",f?"bg-primary-50 border-primary-300 text-primary-700":"bg-white text-gray-700 hover:bg-gray-50"),children:[e.jsx($,{className:"w-5 h-5 mr-2"}),"Filters",M&&e.jsx("span",{className:"ml-2 bg-primary-600 text-white text-xs px-2 py-1 rounded-full",children:Object.values(n).filter(r=>r!==""&&r!=="recent"&&r!==!1).length})]})]}),f&&e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Category"}),e.jsxs("select",{value:n.category,onChange:r=>x("category",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Categories"}),p.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Min Price"}),e.jsx("input",{type:"number",placeholder:"₹0",value:n.minPrice,onChange:r=>x("minPrice",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Price"}),e.jsx("input",{type:"number",placeholder:"₹10000",value:n.maxPrice,onChange:r=>x("maxPrice",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Pricing Unit"}),e.jsxs("select",{value:n.unitType,onChange:r=>x("unitType",r.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Units"}),e.jsx("option",{value:"hour",children:"Per Hour"}),e.jsx("option",{value:"day",children:"Per Day"}),e.jsx("option",{value:"week",children:"Per Week"})]})]})]}),e.jsx("div",{className:"mt-4 flex items-center space-x-6",children:e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",checked:n.verifiedOnly,onChange:r=>x("verifiedOnly",r.target.checked),className:"h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-700",children:"Verified hosts only"})]})}),M&&e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsxs("button",{onClick:T,className:"inline-flex items-center px-3 py-2 text-sm text-gray-600 hover:text-gray-900",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),"Clear all filters"]})})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("p",{className:"text-gray-600",children:d&&a.length===0?"Loading listings...":`Showing ${a.length} listings`}),M&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(W,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Filters active"})]})]}),a.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-8",children:a.map(r=>e.jsx(D,{listing:r,onFavorite:V,isFavorited:E.has(r._id),size:"medium"},r._id))}),l&&e.jsx("div",{ref:S,className:"flex justify-center py-8",children:d?e.jsxs("div",{className:"flex items-center space-x-2 text-gray-500",children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-600"}),e.jsx("span",{children:"Loading more listings..."})]}):e.jsx("button",{onClick:()=>j(!1),className:"px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-200",children:"Load More"})}),!l&&a.length>0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"You've seen all listings"})})]}):e.jsx("div",{className:"text-center py-16",children:d?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto"}),e.jsx("p",{className:"text-gray-500",children:"Loading listings..."})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"mx-auto w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center",children:e.jsx(B,{className:"w-12 h-12 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"No listings found"}),e.jsx("p",{className:"text-gray-500 max-w-md mx-auto",children:M?"Try adjusting your filters or search terms to find what you're looking for.":"Be the first to create a listing in this area!"}),M?e.jsx("button",{onClick:T,className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-200",children:"Clear Filters"}):e.jsx(z,{to:"/listings/create",className:"inline-flex items-center px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-200",children:"Create Listing"})]})})]})};export{ue as default};
