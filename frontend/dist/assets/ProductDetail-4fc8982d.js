import{u as _,r as n,j as e,a as q,b as $,c as T,d as O,e as Y,p as z,L as R,f as h,g as Q,h as U}from"./index-76169fad.js";import{r as I}from"./rentals-588bb37c.js";import{D as W,A as G}from"./DateRangePicker-b09cb43c.js";function H({product:r,onBook:y}){var D,B,C,A,E,F;const{user:s}=_(),[i,w]=n.useState(""),[c,p]=n.useState(""),[g,k]=n.useState(1),[o,P]=n.useState(null),[a,j]=n.useState(null),[b,N]=n.useState(!1),[f,m]=n.useState(""),x=d=>{if(!d)return null;const u=new Date(d);return isNaN(u)?null:u.toISOString()};n.useEffect(()=>{if(i&&c&&(r!=null&&r._id)){const d=setTimeout(()=>{v()},300);return()=>clearTimeout(d)}},[i,c,r==null?void 0:r._id,g]);const v=async()=>{const d=x(i),u=x(c);if(!d||!u){m("Invalid date selection");return}try{N(!0),m("");const[S,L]=await Promise.all([I.checkAvailability(r._id,d,u,g),I.calculatePrice(r._id,d,u)]);P(S.available),j(L)}catch(S){m("Failed to check availability"),console.error(S)}finally{N(!1)}},t=()=>{if(!s){window.location.href="/login";return}if(!o){m("Selected dates are not available");return}y({productId:r._id,startDate:x(i),endDate:x(c),quantity:g,totalPrice:a==null?void 0:a.totalPrice})},l=i&&c&&o&&a&&s;return e.jsxs("div",{className:"bg-white rounded-xl shadow-lg p-6 sticky top-4",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Reserve this item"}),e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(q,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:"Instant booking confirmation"})]})]}),e.jsx(W,{startDate:i,endDate:c,onStartDateChange:w,onEndDateChange:p,className:"mb-6"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Number of items"}),e.jsx("input",{type:"number",min:"1",value:g,onChange:d=>k(parseInt(d.target.value,10)||1),className:"w-full border border-gray-300 rounded-lg px-3 py-2 text-sm"})]}),b&&i&&c&&e.jsx("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{className:"w-4 h-4 mr-2 text-gray-500 animate-spin"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Checking availability..."})]})}),!b&&i&&c&&o!==null&&e.jsx("div",{className:`mb-4 p-3 rounded-lg ${o?"bg-green-50 border border-green-200":"bg-red-50 border border-red-200"}`,children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-2 h-2 rounded-full mr-2 ${o?"bg-green-500":"bg-red-500"}`}),e.jsx("span",{className:`text-sm font-medium ${o?"text-green-800":"text-red-800"}`,children:o?"Available for selected dates":"Not available for selected dates"})]})}),a&&e.jsxs("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx(T,{className:"w-5 h-5 mr-2 text-gray-600"}),e.jsx("h4",{className:"font-semibold text-gray-900",children:"Price Breakdown"})]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-600",children:["₹",(D=a.breakdown)==null?void 0:D.dailyRate," × ",(B=a.breakdown)==null?void 0:B.days," day",((C=a.breakdown)==null?void 0:C.days)>1?"s":""]}),e.jsxs("span",{className:"font-medium",children:["₹",(A=a.breakdown)==null?void 0:A.basePrice]})]}),((E=a.breakdown)==null?void 0:E.discounts)>0&&e.jsxs("div",{className:"flex justify-between text-green-600",children:[e.jsx("span",{children:"Discount"}),e.jsxs("span",{children:["-₹",a.breakdown.discounts]})]}),((F=a.breakdown)==null?void 0:F.fees)>0&&e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Service fees"}),e.jsxs("span",{children:["₹",a.breakdown.fees]})]}),e.jsxs("div",{className:"border-t pt-2 flex justify-between font-bold text-lg",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{className:"text-brand",children:["₹",a.totalPrice]})]})]})]}),f&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-sm text-red-800",children:f})}),s?e.jsx("button",{onClick:t,disabled:!l||b,className:"w-full bg-brand text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:b?"Checking...":l?`Book for ₹${a==null?void 0:a.totalPrice}`:"Select dates to book"}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-gray-600 text-center",children:"Please log in to make a booking"}),e.jsx("a",{href:"/login",className:"block w-full bg-brand text-white py-3 px-4 rounded-lg font-semibold text-center hover:bg-blue-700 transition-colors",children:"Log In to Book"})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t text-xs text-gray-500",children:[e.jsx("p",{children:"• Free cancellation up to 24 hours before pickup"}),e.jsx("p",{children:"• Instant confirmation"}),e.jsx("p",{children:"• 24/7 customer support"})]})]})}function V(){var f,m,x,v;const{id:r}=O(),y=Y(),[s,i]=n.useState(null),[w,c]=n.useState(!0),[p,g]=n.useState(0),[k,o]=n.useState(!1);n.useEffect(()=>{r&&P()},[r]);const P=async()=>{try{c(!0);const t=await z.getProduct(r);i(t.data)}catch(t){console.error("Failed to fetch product:",t)}finally{c(!1)}},a=async t=>{try{await I.createRental({product:t.productId,startDate:t.startDate,endDate:t.endDate,quantity:t.quantity,totalPrice:t.totalPrice}),o(!0),setTimeout(()=>{y("/my-bookings")},2e3)}catch(l){console.error("Booking failed:",l),alert("Booking failed. Please try again.")}};if(w)return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-32 mb-8"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-12",children:[e.jsxs("div",{children:[e.jsx("div",{className:"w-full h-96 bg-gray-200 rounded-xl mb-4"}),e.jsx("div",{className:"flex space-x-2",children:[...Array(4)].map((t,l)=>e.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-lg"},l))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),e.jsx("div",{className:"h-20 bg-gray-200 rounded"})]})]})]})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Product not found"}),e.jsx(R,{to:"/products",className:"text-brand hover:text-blue-700",children:"← Back to products"})]})});const j=s.images&&s.images.length>0?s.images:["https://via.placeholder.com/600x400?text=No+Image"],b=((m=(f=s.pricing)==null?void 0:f[0])==null?void 0:m.rate)||0,N=((v=(x=s.pricing)==null?void 0:x[0])==null?void 0:v.unit)||"day";return k?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center bg-white p-8 rounded-xl shadow-lg max-w-md",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(h,{className:"w-8 h-8 text-green-600"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Booking Confirmed!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Your rental request has been submitted successfully. You'll be redirected to your bookings page."}),e.jsx("div",{className:"animate-spin w-6 h-6 border-2 border-brand border-t-transparent rounded-full mx-auto"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("nav",{className:"mb-8",children:e.jsxs(R,{to:"/products",className:"inline-flex items-center text-brand hover:text-blue-700 font-medium",children:[e.jsx(G,{className:"w-4 h-4 mr-2"}),"Back to Products"]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm overflow-hidden",children:[e.jsx("div",{className:"aspect-w-16 aspect-h-10",children:e.jsx("img",{src:j[p],alt:s.name,className:"w-full h-96 object-cover"})}),j.length>1&&e.jsx("div",{className:"p-4 border-t",children:e.jsx("div",{className:"flex space-x-2 overflow-x-auto",children:j.map((t,l)=>e.jsx("button",{onClick:()=>g(l),className:`flex-shrink-0 w-20 h-20 rounded-lg overflow-hidden border-2 transition-colors ${p===l?"border-brand":"border-gray-200 hover:border-gray-300"}`,children:e.jsx("img",{src:t,alt:`${s.name} ${l+1}`,className:"w-full h-full object-cover"})},l))})})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-8 mt-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:s.name}),e.jsxs("div",{className:"flex items-center space-x-6 mb-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Q,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:s.stock})," ","available"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx($,{className:"w-5 h-5 text-gray-400 mr-2"}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Per ",N," rental"]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"w-5 h-5 text-yellow-400 mr-1"}),e.jsx("span",{className:"text-sm text-gray-600",children:"4.8 (124 reviews)"})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("span",{className:"text-4xl font-bold text-brand",children:["₹",b]}),e.jsxs("span",{className:"text-xl text-gray-600",children:["/",N]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Description"}),e.jsx("p",{className:"text-gray-600 leading-relaxed mb-6",children:s.description}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Features"}),e.jsxs("ul",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-gray-600",children:[e.jsxs("li",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 text-green-500 mr-2"}),"Professional grade equipment"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 text-green-500 mr-2"}),"24/7 customer support"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 text-green-500 mr-2"}),"Free delivery & pickup"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 text-green-500 mr-2"}),"Full insurance coverage"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 text-green-500 mr-2"}),"Instant availability check"]}),e.jsxs("li",{className:"flex items-center",children:[e.jsx(h,{className:"w-4 h-4 text-green-500 mr-2"}),"Flexible rental periods"]})]})]}),s.pricing&&s.pricing.length>1&&e.jsxs("div",{className:"border-t pt-6 mt-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Pricing Options"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:s.pricing.map((t,l)=>e.jsxs("div",{className:"border rounded-lg p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-brand",children:["₹",t.rate]}),e.jsxs("div",{className:"text-sm text-gray-600 capitalize",children:["per ",t.unit]})]},l))})]})]})]}),e.jsx("div",{className:"lg:col-span-1",children:e.jsx(H,{product:s,onBook:a})})]})]})})}export{V as default};
