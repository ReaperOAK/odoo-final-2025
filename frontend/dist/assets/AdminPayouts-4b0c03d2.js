import{r as n,u as V,V as N,j as e,t as W,b as w,U as X}from"./index-76169fad.js";import{g as Z,a as z}from"./payments-eb4ce9d6.js";import{f as E}from"./formatters-7e5feb33.js";import{C as I}from"./CheckCircleIcon-077107a6.js";import{B as _}from"./BanknotesIcon-9d4ab82b.js";import{M as G}from"./MagnifyingGlassIcon-c9e2ef4c.js";function q({title:d,titleId:o,...g},h){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:h,"aria-labelledby":o},g),d?n.createElement("title",{id:o},d):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const J=n.forwardRef(q),F=J;function ae(){var A,D;const[d,o]=n.useState([]),[g,h]=n.useState(!0),[y,v]=n.useState(null),[x,M]=n.useState(""),[p,B]=n.useState("all"),[b,$]=n.useState("newest"),[c,k]=n.useState({}),[r,H]=n.useState(null),[T,j]=n.useState(!1),[i,R]=n.useState({pending:{count:0,amount:0},processed:{count:0,amount:0},failed:{count:0,amount:0},total:{count:0,amount:0}}),{isAdmin:S}=V();n.useEffect(()=>{if(!S()){window.location.href="/";return}C()},[S]);const C=async()=>{try{h(!0);const s=await Z();o(s.data.payouts),U(s.data.payouts),v(null)}catch(s){console.error("Error fetching payouts:",s),v("Failed to load payouts"),N.error("Failed to load payouts")}finally{h(!1)}},U=s=>{const t={pending:{count:0,amount:0},processed:{count:0,amount:0},failed:{count:0,amount:0},total:{count:s.length,amount:0}};s.forEach(a=>{const l=a.amount||0;t.total.amount+=l,a.status==="pending"?(t.pending.count++,t.pending.amount+=l):a.status==="processed"?(t.processed.count++,t.processed.amount+=l):a.status==="failed"&&(t.failed.count++,t.failed.amount+=l)}),R(t)},u=async(s,t)=>{if(window.confirm(`Are you sure you want to ${t} this payout?`)){k(a=>({...a,[s]:!0}));try{await z(s,{action:t}),o(a=>a.map(l=>l._id===s?{...l,status:t==="approve"?"processed":"failed",processedAt:new Date().toISOString()}:l)),N.success(`Payout ${t}d successfully`),j(!1)}catch(a){console.error(`Error ${t}ing payout:`,a),N.error(`Failed to ${t} payout`)}finally{k(a=>({...a,[s]:!1}))}}},O=()=>{let s=d;return x&&(s=s.filter(t=>{var a,l,m;return((a=t.host)==null?void 0:a.name.toLowerCase().includes(x.toLowerCase()))||((l=t.host)==null?void 0:l.email.toLowerCase().includes(x.toLowerCase()))||((m=t.transactionId)==null?void 0:m.toLowerCase().includes(x.toLowerCase()))})),p!=="all"&&(s=s.filter(t=>t.status===p)),s.sort((t,a)=>{var l,m;switch(b){case"newest":return new Date(a.createdAt)-new Date(t.createdAt);case"oldest":return new Date(t.createdAt)-new Date(a.createdAt);case"amount-high":return a.amount-t.amount;case"amount-low":return t.amount-a.amount;case"host":return(m=t.host)==null?void 0:m.name.localeCompare((l=a.host)==null?void 0:l.name);default:return 0}})},P=s=>{switch(s){case"pending":return"bg-yellow-100 text-yellow-800";case"processed":return"bg-green-100 text-green-800";case"failed":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},L=s=>{switch(s){case"pending":return e.jsx(w,{className:"w-4 h-4"});case"processed":return e.jsx(I,{className:"w-4 h-4"});case"failed":return e.jsx(F,{className:"w-4 h-4"});default:return e.jsx(w,{className:"w-4 h-4"})}};if(g)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand"})});if(y)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(W,{className:"mx-auto h-12 w-12 text-red-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"Error"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:y}),e.jsx("div",{className:"mt-6",children:e.jsx("button",{onClick:C,className:"bg-brand text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-blue-700",children:"Try Again"})})]})});const f=O();return e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Payout Management"}),e.jsx("p",{className:"mt-2 text-gray-600",children:"Manage host payouts and earnings"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(w,{className:"h-8 w-8 text-yellow-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.pending.count}),e.jsxs("p",{className:"text-sm text-yellow-600",children:["₹",i.pending.amount.toLocaleString()]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(I,{className:"h-8 w-8 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Processed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.processed.count}),e.jsxs("p",{className:"text-sm text-green-600",children:["₹",i.processed.amount.toLocaleString()]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(F,{className:"h-8 w-8 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Failed"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.failed.count}),e.jsxs("p",{className:"text-sm text-red-600",children:["₹",i.failed.amount.toLocaleString()]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(_,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:i.total.count}),e.jsxs("p",{className:"text-sm text-blue-600",children:["₹",i.total.amount.toLocaleString()]})]})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow mb-6",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between space-y-4 lg:space-y-0",children:[e.jsx("div",{className:"flex-1 max-w-lg",children:e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(G,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:"Search payouts...",value:x,onChange:s=>M(s.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md focus:ring-brand focus:border-brand"})]})}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("select",{value:p,onChange:s=>B(s.target.value),className:"block border-gray-300 rounded-md shadow-sm focus:ring-brand focus:border-brand",children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"processed",children:"Processed"}),e.jsx("option",{value:"failed",children:"Failed"})]}),e.jsxs("select",{value:b,onChange:s=>$(s.target.value),className:"block border-gray-300 rounded-md shadow-sm focus:ring-brand focus:border-brand",children:[e.jsx("option",{value:"newest",children:"Newest First"}),e.jsx("option",{value:"oldest",children:"Oldest First"}),e.jsx("option",{value:"amount-high",children:"Amount: High to Low"}),e.jsx("option",{value:"amount-low",children:"Amount: Low to High"}),e.jsx("option",{value:"host",children:"Host Name A-Z"})]})]})]})}),e.jsx("div",{className:"px-6 py-3 bg-gray-50",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Showing ",f.length," of ",d.length," payouts"]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Host"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Amount"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Period"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map(s=>{var t,a,l;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10",children:(t=s.host)!=null&&t.profileImage?e.jsx("img",{className:"h-10 w-10 rounded-full object-cover",src:s.host.profileImage,alt:""}):e.jsx("div",{className:"h-10 w-10 rounded-full bg-gray-300 flex items-center justify-center",children:e.jsx(X,{className:"h-6 w-6 text-gray-600"})})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:((a=s.host)==null?void 0:a.name)||"Unknown Host"}),e.jsx("div",{className:"text-sm text-gray-500",children:((l=s.host)==null?void 0:l.email)||"No email"})]})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:E(s.amount)}),e.jsxs("div",{className:"text-sm text-gray-500",children:[s.bookingsCount||0," bookings"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P(s.status)}`,children:[L(s.status),e.jsx("span",{className:"ml-1",children:s.status.charAt(0).toUpperCase()+s.status.slice(1)})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[e.jsxs("div",{children:[new Date(s.periodStart).toLocaleDateString()," -"]}),e.jsx("div",{children:new Date(s.periodEnd).toLocaleDateString()})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[e.jsx("button",{onClick:()=>{H(s),j(!0)},className:"text-brand hover:text-blue-700 mr-3",children:"View"}),s.status==="pending"&&e.jsxs("div",{className:"inline-flex space-x-2",children:[e.jsx("button",{onClick:()=>u(s._id,"approve"),disabled:c[s._id],className:"text-green-600 hover:text-green-700 disabled:opacity-50",children:c[s._id]?"Processing...":"Approve"}),e.jsx("button",{onClick:()=>u(s._id,"reject"),disabled:c[s._id],className:"text-red-600 hover:text-red-700 disabled:opacity-50",children:"Reject"})]})]})]},s._id)})})]})}),f.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No payouts found"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"No payouts match your current filters."})]})]}),T&&r&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-2xl shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Payout Details"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Host Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Name"}),e.jsx("p",{className:"font-medium",children:(A=r.host)==null?void 0:A.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Email"}),e.jsx("p",{className:"font-medium",children:(D=r.host)==null?void 0:D.email})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Amount"}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:E(r.amount)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Status"}),e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${P(r.status)}`,children:[L(r.status),e.jsx("span",{className:"ml-1",children:r.status.charAt(0).toUpperCase()+r.status.slice(1)})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Period"}),e.jsxs("p",{className:"font-medium",children:[new Date(r.periodStart).toLocaleDateString()," -"," ",new Date(r.periodEnd).toLocaleDateString()]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Bookings"}),e.jsx("p",{className:"font-medium",children:r.bookingsCount||0})]})]}),r.transactionId&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Transaction ID"}),e.jsx("p",{className:"font-medium font-mono text-sm",children:r.transactionId})]}),r.status==="pending"&&e.jsxs("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[e.jsx("button",{onClick:()=>u(r._id,"approve"),disabled:c[r._id],className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 disabled:opacity-50",children:c[r._id]?"Processing...":"Approve Payout"}),e.jsx("button",{onClick:()=>u(r._id,"reject"),disabled:c[r._id],className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 disabled:opacity-50",children:"Reject Payout"})]})]})]})})})]})})}export{ae as default};
